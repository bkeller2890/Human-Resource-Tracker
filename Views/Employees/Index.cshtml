@model HRTracker.Models.PagedResult<HRTracker.Models.Employee>

@{
    ViewData["Title"] = "Employees";
    var currentSearch = ViewData["SearchString"] as string ?? string.Empty;
}

<h1>Employees</h1>

<form method="get" class="mb-3">
    <div class="input-group">
    <select name="departmentId" class="form-select me-2 p-2" style="max-width:240px;">
            <option value="">All Departments</option>
            @{
                var deptItems = ViewData["DepartmentFilter"] as IEnumerable<Microsoft.AspNetCore.Mvc.Rendering.SelectListItem>;
                if (deptItems != null)
                {
                    foreach (var d in deptItems)
                    {
                        if (d.Selected)
                        {
                            <option value="@d.Value" selected="selected">@d.Text</option>
                        }
                        else
                        {
                            <option value="@d.Value">@d.Text</option>
                        }
                    }
                }
            }
        </select>
    <input type="text" name="searchString" value="@currentSearch" class="form-control p-2" placeholder="Search by name or email" />
    <button class="btn btn-primary rounded" type="submit">Search</button>
    <a class="btn btn-outline-secondary rounded" href="@Url.Action("Index", "Employees")">Clear</a>
    </div>
    <input type="hidden" name="page" value="1" />
</form>

<p>
    <create-button href="@Url.Action("Create","Employees")" />
</p>

<table class="table">
    <thead>
        <tr>
            <th>Employee Id</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
            <th>Position</th>
            <th>Department</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
    @foreach (var item in Model.Items)
    {
        <tr>
            <td>@item.EmployeeId</td>
            <td>@item.FirstName</td>
            <td>@item.LastName</td>
            <td>@item.Email</td>
            <td>@item.Position</td>
            <td>@(item.Department?.Name ?? "-")</td>
            <td>
                <a asp-action="Edit" asp-route-id="@item.EmployeeId">Edit</a> |
                <a asp-action="Details" asp-route-id="@item.EmployeeId">Details</a> |
                <a asp-action="Delete" asp-route-id="@item.EmployeeId" class="text-danger">Delete</a>
            </td>
        </tr>
    }
    </tbody>
</table>

<nav aria-label="Page navigation">
    <ul class="pagination">
        <li class="page-item @(Model.Page <= 1 ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("Index", new { searchString = currentSearch, departmentId = ViewData["SelectedDepartment"], page = Model.Page - 1 })">Previous</a>
        </li>
        <li class="page-item disabled">
            <span class="page-link">Page @Model.Page of @Model.TotalPages</span>
        </li>
        <li class="page-item @(Model.Page >= Model.TotalPages ? "disabled" : "")">
            <a class="page-link" href="@Url.Action("Index", new { searchString = currentSearch, departmentId = ViewData["SelectedDepartment"], page = Model.Page + 1 })">Next</a>
        </li>
    </ul>
</nav>
